#!/usr/bin/env perl

use common::sense;


use AnyEvent::Loop; # FIXME: EV not playing nice with Net::OpenSSH < 0.71
#use EV;
use AnyEvent;
use Getopt::Long;

use Vmprobe::Daemon::Util;
use Vmprobe::Daemon::API;



die "must not run as root"
    if $< == 0 || $> == 0;



my $config_file = '/etc/vmprobed/vmprobed.conf';
my $nodaemon;

GetOptions(
    'config|c=s' => \$config_file,
    'nodaemon' => \$nodaemon,
) || die "error in command-line arguments";

Vmprobe::Daemon::Util::load_config($config_file);




my $api;

if (config->{api}) {
    $api = Vmprobe::Daemon::API->new;
}

AE::cv->recv;
